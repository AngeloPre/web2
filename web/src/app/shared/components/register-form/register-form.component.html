<form #f="ngForm" (ngSubmit)="onSubmit(f)" class="p-5 border border-figma-gray-200 rounded-xl">
  <h1 class="text-3xl font-bold font-lato text-figma-gray-500">Crie sua conta</h1>
  <p class="text-base font-lato text-figma-gray-400 mt-2">Informe seus dados</p>

  <mat-stepper [linear]="true" class="w-full stepper-pb0 stepper-py" labelPosition="bottom">
    <mat-step [stepControl]="dadosGroup.control">
      <ng-template matStepLabel>Dados</ng-template>

      <section ngModelGroup="dados" #dadosGroup="ngModelGroup" class="mt-3">
        <mat-form-field class="w-full">
          <mat-label>CPF</mat-label>
          <input matInput placeholder="CPF" [(ngModel)]="cliente.cpf" name="cpf" mask="000.000.000-00" required>
          @if (cliente.cpf) {
            <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparCampo('cpf')">
              <mat-icon class="mr-3">close</mat-icon>
            </button>
          }
        </mat-form-field>

        <mat-form-field class="w-full">
          <mat-label>Nome</mat-label>
          <input matInput placeholder="Digite o nome completo" [(ngModel)]="cliente.nome" name="nome" required>
          @if (cliente.nome) {
            <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparCampo('nome')">
              <mat-icon class="mr-3">close</mat-icon>
            </button>
          }
        </mat-form-field>

        <mat-form-field class="w-full">
          <mat-label class="text-sm font-lato">E-MAIL</mat-label>
          <input  matInput
                  placeholder="exemplo@email.com"
                  [(ngModel)]="cliente.email"
                  name="email"
                  #emailModel="ngModel"
                  type="email"
                  email
                  required
                  [ngModelOptions]="{ updateOn: 'change' }"
                  emailUnico
                  class="placeholder:font-lato placeholder:text-sm placeholder:text-figma-gray-400">
          @if (cliente.email) {
            <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparCampo('email')">
              <mat-icon class="mr-3">close</mat-icon>
            </button>
          }
          @if (emailModel?.errors?.['required']) {
            <mat-error>E-mail é obrigatório.</mat-error>
          }
          @if (emailModel?.errors?.['email']) {
            <mat-error>Formato de e-mail inválido.</mat-error>
          }
          @if (emailModel?.errors?.['jaExisteEmail']) {
            <mat-error>Este e-mail já está cadastrado.</mat-error>
          }
        </mat-form-field>

        <div class="flex gap-2">
          <mat-form-field>
            <mat-label>Telefone</mat-label>
            <input matInput placeholder="(xx) x xxxx-xxxx" [(ngModel)]="cliente.telefone" name="telefone" mask="(00) 0 0000-0000" required>
            @if (cliente.telefone) {
              <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparCampo('telefone')">
                <mat-icon class="mr-3">close</mat-icon>
              </button>
            }
          </mat-form-field>
        </div>
      </section>

      <div class="flex">
        <button mat-button matStepperNext type="button" class="figma-ghost flex-1">Próximo</button>
      </div>
    </mat-step>

    <mat-step [stepControl]="enderecoGroup.control">
      <ng-template matStepLabel>Endereço</ng-template>

      <section ngModelGroup="endereco" #enderecoGroup="ngModelGroup" class="mt-3">
        <div class="flex gap-2">
          <mat-form-field>
            <mat-label>CEP</mat-label>
            <input matInput placeholder="Digite seu cep"
                   [(ngModel)]="cliente.endereco.cep"
                   name="cep"
                   #cepModel="ngModel"
                   mask="00.000-000"
                   required
                   [ngModelOptions]="{ updateOn: 'change' }"
                   (change)="buscarCep(cepModel)"
                   cepValido>
            @if (cliente.endereco.cep) {
              <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparEnderecoCampo('cep')">
                <mat-icon class="mr-3">close</mat-icon>
              </button>
            }

            @if (cepModel?.errors?.['required']) {
              <mat-error>CEP é obrigatório.</mat-error>
            }
            @if (cepModel?.errors?.['cepInvalido']) {
              <mat-error>CEP não encontrado.</mat-error>
            }
          </mat-form-field>

          <mat-form-field>
            <mat-label>UF</mat-label>
            <mat-select required name="uf" [(ngModel)]="cliente.endereco.uf">
              @for (uf of listaUfs; track uf) {
                <mat-option [value]="uf" class="placeholder:font-lato placeholder:text-sm">{{ uf }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <mat-form-field class="w-full">
          <mat-label class="text-sm font-lato">LOGRADOURO</mat-label>
          <input  matInput
                  placeholder="Rua Exemplo A"
                  [(ngModel)]="cliente.endereco.logradouro"
                  name="logradouro"
                  required
                  class="placeholder:font-lato placeholder:text-sm placeholder:text-figma-gray-400">
          @if (cliente.endereco.logradouro) {
            <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparEnderecoCampo('logradouro')">
              <mat-icon class="mr-3">close</mat-icon>
            </button>
          }
        </mat-form-field>

        <div class="flex gap-2">
          <mat-form-field>
            <mat-label>CIDADE</mat-label>
            <input matInput [(ngModel)]="cliente.endereco.cidade" name="cidade" required>
            @if (cliente.endereco.cidade) {
              <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparEnderecoCampo('cidade')">
                <mat-icon class="mr-3">close</mat-icon>
              </button>
            }
          </mat-form-field>

          <mat-form-field>
            <mat-label>BAIRRO</mat-label>
            <input matInput [(ngModel)]="cliente.endereco.bairro" name="bairro" required>
            @if (cliente.endereco.bairro) {
              <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparEnderecoCampo('bairro')">
                <mat-icon class="mr-3">close</mat-icon>
              </button>
            }
          </mat-form-field>
        </div>

        <div class="flex gap-2">
          <mat-form-field class="flex-1">
            <mat-label>COMPLEMENTO</mat-label>
            <input matInput [(ngModel)]="cliente.endereco.complemento" name="complemento">
            @if (cliente.endereco.complemento) {
              <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparEnderecoCampo('complemento')">
                <mat-icon class="mr-3">close</mat-icon>
              </button>
            }
          </mat-form-field>
          <mat-form-field class="flex-1">
            <mat-label>NÚMERO</mat-label>
            <input matInput [(ngModel)]="cliente.endereco.numero" name="numero" required>
            @if (cliente.endereco.numero) {
              <button matSuffix matIconButton aria-label="Clear" type="button" (click)="limparEnderecoCampo('numero')">
                <mat-icon class="mr-3">close</mat-icon>
              </button>
            }
          </mat-form-field>
        </div>
      </section>

      <div class="flex flex-1 gap-2">
        <button mat-button matStepperPrevious type="button" class="figma-ghost flex-1">Voltar</button>
        <button mat-button matStepperNext type="button" class="figma-ghost flex-1">Próximo</button>
      </div>
    </mat-step>

    <mat-step>
      <div class="flex flex-col gap-3 mt-3">
        <ng-template matStepLabel>Revisão</ng-template>

        <div class="flex flex-col gap-1 text-sm">
          <div><strong>CPF:</strong> {{ cliente.cpf }}</div>
          <div><strong>Nome:</strong> {{ cliente.nome }}</div>
          <div><strong>E-mail:</strong> {{ cliente.email }}</div>
          <div><strong>Telefone:</strong> {{ cliente.telefone }}</div>
          <div><strong>CEP:</strong> {{ cliente.endereco.cep }}</div>
          <div><strong>Logradouro:</strong> {{ cliente.endereco.logradouro }}, {{ cliente.endereco.numero }}</div>
          <div><strong>Complemento:</strong> {{ cliente.endereco.complemento || '-' }}</div>
          <div><strong>Bairro/Cidade/UF:</strong> {{ cliente.endereco.bairro }} - {{ cliente.endereco.cidade }} / {{ cliente.endereco.uf }}</div>
        </div>

        <div class="flex flex-col gap-2">
          <button mat-button matStepperPrevious type="button" class="figma-ghost">Voltar</button>
          <button mat-flat-button class="w-full font-lato" type="submit">Cadastrar</button>
        </div>
      </div>
    </mat-step>
  </mat-stepper>
</form>
<div class="p-4 border border-figma-gray-200 rounded-xl mt-4">
  <h1 class="font-bold font-lato text-figma-gray-500">Já tem uma conta?</h1>
  <p class="text-sm font-lato text-figma-gray-400 mt-2">Entre agora mesmo</p>
  <button
  routerLink="/login"
  class="w-full mt-8 bg-figma-gray-200
    font-sans hover:bg-figma-gray-300
    hover:text-figma-gray-100 py-2 px-4  border-figma-gray-600 hover:border-transparent rounded">Acessar conta</button>
</div>
